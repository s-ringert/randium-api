{
    "packages": {
        "yum": {
            "nodejs": []
        }
    },

    "option_settings": [
        {
            "namespace": "aws:elasticbeanstalk:application:environment",
            "option_name": "COMPOSER_HOME",
            "value": "/root"
        },
        {
            "namespace": "aws:elasticbeanstalk:container:php:phpini",
            "option_name": "document_root",
            "value": "/public"
        },
        {
            "namespace": "aws:elasticbeanstalk:container:php:phpini",
            "option_name": "memory_limit",
            "value": "256M"
        }
    ],

    "container_commands": {
        "01_install_composer_dependencies": {
            "command": "php -d memory_limit=-1 /usr/bin/composer.phar install --no-dev --no-interaction --prefer-dist --optimize-autoloader",
            cwd: "/var/app/staging"
        },
        "02_npm_install_dependencies": {
            "command": "npm install",
            cwd: "/var/app/staging"
        },
        "03_npm_build": {
            "command": "npm run build",
            cwd: "/var/app/staging"
        },
        "04_run_migrations": {
            "command": "php artisan migrate --force",
            cwd: "/var/app/staging"
        }
    }
}
